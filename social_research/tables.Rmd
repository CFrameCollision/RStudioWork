---
title             : "The Interplay of Race/Ethnicity and Parental Education in College Completion: A Cohort Analysis"
shorttitle        : "The Interplay of Race/Ethnicity and Parental"

author: 
  - name          : "Christopher Byrd"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "300 W Hawthorne Rd, Spokane, WA 99251"
    email         : "cbyrd25@my.whitworth.edu"

affiliation:
  - id            : "1"
    institution   : "Whitworth University"

authornote: |
  Whitworth University Sociology Department, Criminology Major. https://orcid.org/0009-0004-0100-0798

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  One or two sentences to put the results into a more **general context**.
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

floatsintext      : yes
linenumbers       : no
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

appendix          : appendix-a.Rmd


classoption       : "man"
output            : papaja::apa6_pdf

bibliography      : references.bib
---

```{r setup, include = FALSE}
library("papaja")
r_refs("references.bib")

library(MASS)
library(tidyverse)
library(extrafont)
library(ggthemes)
library(colorspace)
library(addinslist)
library(gmodels)
library(RColorBrewer)
library(DescTools)
library(viridis)
library(ggpmisc)
library(naniar)
library(broom)
library(mice)
library(survey)
library(MissMech)

source('data/nlsy97-educational-data/nlsy97-educational-data.R')

# Race key:
# 1 Black
# 2 Hispanic
# 3 Mixed Race (Non-Hispanic)
# 4 Non-Black

# Filter out non-responses

new_data <- new_data %>%
  mutate(degree_label = case_when(
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 0 ~ "None",
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 1 ~ "GED",
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 2 ~ "HS Diploma",
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 3 ~ "AA",
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 4 ~ "BA",
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 5 ~ "MA",
    CV_HIGHEST_DEGREE_EVER_EDT_2017 == 6 ~ "PhD",
    TRUE ~ NA_character_))

# Descriptive characteristics of respondents

# Degree attained

new_data <- new_data %>%
  mutate(degree_label = factor(degree_label,
                               levels = c("None", "GED", "HS Diploma",
                                          "AA", "BA", "MA", "PhD")))

new_data_rmNA <- new_data %>% dplyr::filter(!is.na(degree_label))

# Removes outliers
new_data_rmNA <- new_data_rmNA %>%
  filter(CV_HGC_RES_MOM_1997 <= 20 | is.na(CV_HGC_RES_MOM_1997)) %>%
  filter(CV_HGC_RES_DAD_1997 <= 20 | is.na(CV_HGC_RES_DAD_1997))
```

The United States features a diverse system of education. As diverse as the processes between states and districts is the students who reside in each, with further divisions manifesting themselves in differing educational outcomes.

Among U.S. adults born from 1980 to 1984, how does the intersection of race/ethnicity and parental education affect completion of a bachelor’s degree or higher by 2017 (age's 33-37)? This question is of particular interest as educational inequality is rampant in the united states

# Literature Review (1.5-3 pg)

• What have others written about these subjects? • What theoretical approach are you interacting with? • Use the literature to make a case for why your project is necessary. State your hypothesis. This does not need to be in a separate section, put it where it fits in your paper. Be sure to describe your expectations and explain your logic. (.5-1 pg)

# Methods (1.5-2.5 pg)

As previously described, the sample used was the National Longitudinal Survey of Youth 1997 (NLSY97) conducted by the US Bureau of Labor Statistics (BLS). This is a nationally representative sample carried out every year pre-2011 and every two years thereafter, with selection finalized in 1997 and round 0 of questions carried out in 1998. This database was chosen due to it's large sample size (\~8,000 respondents), robust and comprehensive question selection, representative nature, and ease of access. The sampling strategy, as described by the BLS, is as follows:

> The NLSY97 cohort was selected in two phases... In the first phase, a list of housing units for the cross-sectional sample and the over-sample was derived from two independently selected, stratified multistage area probability samples. This ensured an accurate representation of different sections of the population defined by race, income, region, and other factors. In the second phase, sub-samples of the eligible persons identified in the first phase were selected for interview.

Additional information about the NLSY97 is available on the NLS website [here](https://www.nlsinfo.org/content/cohorts/nlsy97 "NLS Info website").

Within the NLSY97, the data was subset to specify participants in round 18 who responded with an answer to the following question: [What is] the highest degree received as of the survey date? This was on a scale of of 0 to 7, with zero representing no high school completion and 7 representing a doctorates degree. Important to note is the difference in scales between parental and respondent education levels (see appendix A for the complete codebook).

A unique aspect of the data which made analysis more complex was the number of answers missing from the residential dad educational variable (round 1). Residential dad was chosen, as this study is attempting to determine how parents living in the same household affect their children's future education. To determine whether the pattern was random, Jamshidian and Jalal's [-@jamshidian2010] Non-Parametric MCAR Test. Following this, data was imputed using the mice package, which utilizes Gibbs sampling. The imputation method chosen was predictive mean matching (PMM), as PMM provides plausible data that is more robust than other methods [@vanbuuren2018].

Following

• Identify population, describe sampling strategy and why you chose that strategy. • What are the indicators of your variables? • How did you actually carry out the research? (study design and process) • Describe your data analysis – statistical test if quant or coding process if qual • Why is this context and this method the best choice for your research question?

# Results (1-2 pg)

The

```{r echo=FALSE, warning=FALSE, fig.cap="Fig"}
theme_set(theme_apa())
#title = "Highest Degree Attained of Parents (Overall)"
ggplot(new_data_rmNA, aes(x = degree_label)) +
  geom_bar(fill = "steelblue") +
  labs(x = "Degree") +
  stat_count(geom = 'text', 
             color = 'black', 
             aes(label = after_stat(count)),
             position = position_stack(vjust = 1.05))
```

```{r echo=FALSE, warning=FALSE, fig.cap="a"}
#title = "Highest Degree Attained (Mother)"
ggplot(new_data_rmNA, aes(x = CV_HGC_RES_MOM_1997)) +
  geom_bar(fill = "lightgreen") +
  labs(x = "Degree") +
  stat_count(geom = 'text', 
             color = 'black', 
             aes(label = after_stat(count)),
             position = position_stack(vjust = 1.05))
```

```{r echo=FALSE, warning=FALSE, fig.cap="row"}
#title = "Highest Degree Attained (Father)"
ggplot(new_data_rmNA, aes(x = CV_HGC_RES_DAD_1997)) +
  geom_bar(fill = "lightpink") +
  labs(x = "Degree") +
  stat_count(geom = 'text', 
             color = 'black', 
             aes(label = after_stat(count)),
             position = position_stack(vjust = 1.05))
```

• What were the results? • Provide descriptive statistics for key variables as well as results of data analysis • Data summaries are ok – i.e. tables & charts

```{r echo=FALSE, warning=FALSE, fig.cap=""}
##########  Start of missing data analysis ##########
# Looking at missing-ness by race/ethnicity
new_data_rmNA %>%
  dplyr::select(KEY_RACE_ETHNICITY_1997, CV_HGC_RES_MOM_1997, CV_HGC_RES_DAD_1997) %>%
  mutate(
    mom_missing = is.na(CV_HGC_RES_MOM_1997),
    dad_missing = is.na(CV_HGC_RES_DAD_1997)
  ) %>%
  group_by(KEY_RACE_ETHNICITY_1997) %>%
  summarise(
    n = n(),
    mom_missing_pct = mean(mom_missing) * 100,
    dad_missing_pct = mean(dad_missing) * 100
  )

# Testing for patterns in missing-ness

gg_miss_upset(new_data_rmNA)

mcar_data <- new_data_rmNA %>%
  dplyr::select(CV_HIGHEST_DEGREE_EVER_EDT_2017,
                CV_HGC_RES_MOM_1997,
                CV_HGC_RES_DAD_1997) %>%
  mutate(across(everything(), as.numeric))

mcar_test(mcar_data)

# Apply Jamshidian and Jalals test
MCAR_Test_Result <- TestMCARNormality(mcar_data)

# View result
print(MCAR_Test_Result)


##########  Imputations ##########
# Multiple imputations 

imp_data <- new_data_rmNA %>%
  dplyr::select(CV_HIGHEST_DEGREE_EVER_EDT_2017,
         KEY_RACE_ETHNICITY_1997, CV_HGC_RES_MOM_1997,
         CV_HGC_RES_DAD_1997, SAMPLING_WEIGHT_CC_2017)

imp <- mice(imp_data, m = 5, method = 'pmm')

imp <- complete(imp, action = "long", include = TRUE)

# Factors imputations
imp$CV_HIGHEST_DEGREE_EVER_EDT_2017 <- factor(
  imp$CV_HIGHEST_DEGREE_EVER_EDT_2017,
  levels = 0:6,
  labels = c("None", "GED", "HS", "AA", "BA", "MA", "PhD"),
  ordered = TRUE
)

# Re-convert to mids object
imp <- as.mids(imp)

# Runs ordinal log regr on imp data
pom_imp <- with(imp, polr(
  CV_HIGHEST_DEGREE_EVER_EDT_2017 ~ CV_HGC_RES_MOM_1997 +
    KEY_RACE_ETHNICITY_1997 + CV_HGC_RES_DAD_1997,
  Hess = TRUE
))

# Pool the results
# !!!!!Remember data is logarithmic!!!!!
pom_pooled <- pool(pom_imp)
summary(pom_pooled)

# Converting pooled results to tidy format
pooled_summary <- summary(pom_pooled)

# Adding term names
tidy_pooled <- tidy(pom_pooled, conf.int = TRUE, conf.level = 0.95)

tidy_pooled_sub <- subset(tidy_pooled, tidy_pooled$estimate <= 0.8)

# Plot for predictors
# title = "Pooled Coefficient Estimates from Imputed polr Model"
ggplot(tidy_pooled_sub, aes(x = estimate, y = reorder(term, estimate))) +
  geom_point() +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  labs(x = "Log Odds Estimate", y = "Predictor Estimate")

tidy_pooled_sub <- subset(tidy_pooled, tidy_pooled$estimate > 0.8)

# Plot for thresholds
# title = "Pooled Coefficient Estimates from Imputed polr Model"
ggplot(tidy_pooled_sub, aes(x = estimate, y = reorder(term, estimate))) +
  geom_point() +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  labs(x = "Log Odds Estimate", y = "Threshold Estimate")

# Selects an imp
completed_data <- complete(imp, action = 5L)

# Weighted GLM
completed_data$degree_num <- as.numeric(
  completed_data$CV_HIGHEST_DEGREE_EVER_EDT_2017)

svy_design <- svydesign(
  ids = ~1,
  weights = ~SAMPLING_WEIGHT_CC_2017,
  data = completed_data
)

svy_model <- svyglm(
  degree_num ~ CV_HGC_RES_MOM_1997 +
    KEY_RACE_ETHNICITY_1997 + CV_HGC_RES_DAD_1997,
  design = svy_design
)

summary(svy_model)

# Visualize pooled regression coefficients of imps (not done yet)

library(effects)

# Use one completed data set as demonstration
effect_svy_model <- effects::Effect(c("KEY_RACE_ETHNICITY_1997", "CV_HGC_RES_MOM_1997"),
               svy_model)

# For predicted probabilities
as.data.frame(effect_svy_model)
```

# Analysis (1.5-2.5 pg)

• What patterns are there in the responses? Discuss how these might shed light on your research question. On your hypothesis? • Is the data strong enough to make a conclusion for your hypothesis? How do you know?

# Discussion (1.5-2.5pg)

\newpage

# References

::: {#refs custom-style="Bibliography"}
:::

\newpage

# (APPENDIX) Appendix {.unnumbered}

```{r child = "appendix-a.Rmd"}
```
